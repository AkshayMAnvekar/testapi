module.exports=function(e){var t={};function r(o){if(t[o])return t[o].exports;var s=t[o]={i:o,l:!1,exports:{}};return e[o].call(s.exports,s,s.exports,r),s.l=!0,s.exports}return r.m=e,r.c=t,r.d=function(e,t,o){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(r.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)r.d(o,s,function(t){return e[t]}.bind(null,s));return o},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/dist/",r(r.s=4)}([function(e,t){e.exports=require("mongoose")},function(e,t){e.exports=require("express")},function(e,t){e.exports=require("jsonwebtoken")},function(e,t,r){const o=r(0),s=o.Schema({fileName:{type:String,required:!0},data:{type:Buffer,required:!0},contentType:{type:String,required:!0}});e.exports=o.model("Img",s)},function(e,t,r){r(5),e.exports=r(6)},function(e,t){e.exports=require("babel-polyfill")},function(e,t,r){const o=r(7),s=r(8),n=(r(0),(e=>{const t=parseInt(e,10);return isNaN(t)?e:t>=0&&t})(process.env.PORT||"3000"));s.set("port",n);const i=o.createServer(s);i.on("error",e=>{if("listen"!==e.syscall)throw e;const t=i.address(),r="string"==typeof t?"pipe "+t:"port: "+n;switch(e.code){case"EACCES":console.error(r+" requires elevated privileges."),process.exit(1);break;case"EADDRINUSE":console.error(r+" is already in use."),process.exit(1);break;default:throw e}}),i.on("listening",()=>{const e=i.address(),t="string"==typeof e?"pipe "+e:"port "+n;console.log("Listening on "+t)}),i.listen(n)},function(e,t){e.exports=require("http")},function(e,t,r){const o=r(1),s=r(9),n=r(0),i=r(10),a=r(17),u=o();u.disable("X-Powered-By"),n.connect("mongodb+srv://anv:IPTiGtk3bPsMxAk7@adb-2mbax.mongodb.net/test?retryWrites=true&w=majority",{useUnifiedTopology:!0,useNewUrlParser:!0,useCreateIndex:!0}).then(()=>{console.log("Successfully connected to MongoDB Atlas!")}).catch(e=>{console.log("Unable to connect to MongoDB Atlas!"),console.error(e)}),u.use((e,t,r)=>{t.setHeader("Access-Control-Allow-Origin","*"),t.setHeader("Access-Control-Allow-Headers","Origin, X-Requested-With, Content, Accept, Content-Type, Authorization"),t.setHeader("Access-Control-Allow-Methods","GET, POST, PUT, DELETE, PATCH, OPTIONS"),r()}),u.use(s.json()),u.use("/api/note",i),u.use("/api/auth",a),e.exports=u},function(e,t){e.exports=require("body-parser")},function(e,t,r){const o=r(1).Router(),s=r(11),n=r(12),i=r(14);o.get("/",s,i.getNotes),o.post("/",s,n,i.createNote),o.get("/:id",s,i.getOneNote),o.put("/:id",s,i.modifyNote),o.delete("/:id",s,i.deleteNote),e.exports=o},function(e,t,r){const o=r(2);e.exports=(e,t,r)=>{if(e.headers.authorization)try{const s=e.headers.authorization.split(" ")[1],n=o.verify(s,"RANDOM_TOKEN_SECRET").userId;if(e.body.userId&&e.body.userId!==n)throw"Invalid user ID";t.locals.user=e.body.userId,t.locals.authenticated=!0,r()}catch{t.status(401).json({error:new Error("Invalid request!")})}else t.locals.user=e.body.userId,t.locals.authenticated=!1,r()}},function(e,t,r){const o=r(13),s=o.memoryStorage();e.exports=o({storage:s}).single("image")},function(e,t){e.exports=require("multer")},function(e,t,r){const o=r(15),s=r(3),n=r(16);t.createNote=(e,t,r)=>{if(t.locals.authenticated){const r=new s({fileName:e.file.originalname.split(" ").join("_"),data:e.file.buffer,contentType:e.file.mimetype});r.save().then(()=>{const s=new o({title:e.body.title,description:e.body.description,imageId:r.id,userId:e.body.userId,privateFlag:e.body.privateFlag});console.log("Note Created",s),s.save().then(()=>{t.status(201).json({message:"Post saved successfully!"})}).catch(e=>{t.status(400).json({error:e})})}).catch(e=>{t.status(400).json({error:e})})}else t.status(401).json({error:new Error("Unauthorized request!")})},t.getOneNote=(e,t,r)=>{o.findOne({_id:e.params.id}).then(e=>{t.status(200).json(e)}).catch(e=>{t.status(404).json({error:e})})},t.modifyNote=(e,t,r)=>{if(t.locals.authenticated){const r=new o({_id:e.params.id,title:e.body.title,description:e.body.description,imageUrl:e.body.imageUrl,price:e.body.price,userId:e.body.userId});o.updateOne({_id:e.params.id},r).then(()=>{t.status(201).json({message:"Note updated successfully!"})}).catch(e=>{t.status(400).json({error:e})})}else t.status(401).json({error:new Error("Unauthorized request!")})},t.deleteNote=(e,t,r)=>{t.locals.authenticated?o.deleteOne({_id:e.params.id}).then(()=>{t.status(200).json({message:"Deleted!"})}).catch(e=>{t.status(400).json({error:e})}):t.status(401).json({error:new Error("Unauthorized request!")})},t.getNotes=async(e,t,r)=>{const s=!0===t.locals.authenticated?[!0,!1]:[!1],i=e.query.page?parseInt(e.query.page):1,a=e.query.size?parseInt(e.query.size):10,u=(i-1)*a;if(e.query.search||e.body.search){const r=e.query.search||e.body.search;o.find({title:{$regex:r,$options:"i"},privateFlag:{$in:s}},null,{limit:a,skip:u}).then(async e=>{t.status(200).json(await n(e))}).catch(e=>{console.log(e),t.status(400).json({error:e})})}else o.find({privateFlag:{$in:s}},null,{limit:a,skip:u}).then(async e=>{t.status(200).json(await n(e))}).catch(e=>{t.status(400).json({error:e})})}},function(e,t,r){const o=r(0),s=o.Schema({title:{type:String,required:!0},description:{type:String,required:!0},imageId:{type:String,required:!0},userId:{type:String,required:!0},privateFlag:{type:Boolean,required:!0}});e.exports=o.model("Note",s)},function(e,t,r){const o=r(3);e.exports=async function(e){const t=[];for(everyNote of e)newNote={},newNote.id=everyNote._id,newNote.title=everyNote.title,newNote.description=everyNote.description,newNote.userId=everyNote.userId,newNote.privateFlag=everyNote.privateFlag,newNote.imageData=await o.findOne({_id:everyNote.imageId}).then(e=>({mimeType:e.contentType,imgData:e.data})).catch(e=>({error:e})),t.push(newNote);return t}},function(e,t,r){const o=r(1).Router(),s=r(18);o.post("/signup",s.signup),o.post("/login",s.login),e.exports=o},function(e,t,r){const o=r(19),s=r(20),n=r(2);t.signup=(e,t,r)=>{o.hash(e.body.password,10).then(r=>{new s({email:e.body.email,password:r}).save().then(()=>{t.status(201).json({message:"User added successfully!"})}).catch(e=>{t.status(500).json({error:e})})})},t.login=(e,t,r)=>{s.findOne({email:e.body.email}).then(r=>{if(!r)return t.status(401).json({error:new Error("User not found!")});o.compare(e.body.password,r.password).then(e=>{if(!e)return t.status(401).json({error:new Error("Incorrect password!")});const o=n.sign({userId:r._id},"RANDOM_TOKEN_SECRET",{expiresIn:"24h"});t.status(200).json({userId:r._id,token:o})}).catch(e=>{t.status(500).json({error:e})})}).catch(e=>{t.status(500).json({error:e})})}},function(e,t){e.exports=require("bcrypt")},function(e,t,r){const o=r(0),s=r(21),n=o.Schema({email:{type:String,required:!0,unique:!0},password:{type:String,required:!0}});n.plugin(s),e.exports=o.model("User",n)},function(e,t){e.exports=require("mongoose-unique-validator")}]);